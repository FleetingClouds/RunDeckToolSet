- id: net.fleetingclouds.install.joomla
  project: PrepareGenericVPS
  loglevel: INFO
  sequence:
    keepgoing: false
    strategy: node-first
    commands:
    - exec: echo "Install Joomla ......................................................."
    - exec: 'echo " ####################  Calling [InstallMySql] ###################
        "'
    - jobref:
        group: net/fleetingclouds/install
        name: InstallMySql
        args: -MySqlRootPwd ${option.MySqlRootPwd} -PurgeApache ${option.PurgeApache} -sudoPwdRunDeck ${option.sudoPwdRunDeck}
    - exec: 'echo " ####################  Calling [PrepareJoomlaDatabase] ###################
        "'
    - jobref:
        group: net/fleetingclouds/install/joomla
        name: PrepareJoomlaDatabase
        args: -JoomlaDataBase ${option.JoomlaDataBase} -MySqlJoomlaPwd ${option.MySqlJoomlaPwd} -MySqlJoomlaUser ${option.MySqlJoomlaUser} -MySqlRootPwd ${option.MySqlRootPwd} -MySqlServer ${option.MySqlServer}  -sudoPwdRunDeck  ${option.sudoPwdRunDeck}
    - exec: 'echo " ####################  Calling [PrepareApache] ###################
        "'
    - jobref:
        group: net/fleetingclouds/install/apache
        name: PrepareApache
        args: -Host <> -sudoPwdRunDeck ${option.sudoPwdRunDeck}
    - exec: 'echo " ####################  Calling [PreparePhp] ###################
        "'
    - jobref:
        group: net/fleetingclouds/install/php
        name: PreparePhp
    - exec: 'echo " ####################  Calling [PrepareJoomla] ###################
        "'
    - jobref:
        group: net/fleetingclouds/install/joomla
        name: PrepareJoomla
        args: -MySqlJoomlaPwd ${option.MySqlJoomlaPwd}
    - exec: sudo /etc/init.d/apache restart
    - exec: 'echo " ####################  Calling [GetAkeebaSubscriptions] ###################
        "'
    - jobref:
        group: net/fleetingclouds/install/joomla/akeeba
        name: GetAkeebaSubscriptions
        args: -sudoPwdRunDeck ${option.sudoPwdRunDeck} -InstallersRepository ${option.InstallersRepository}
    - exec: 'echo " ####################  Calling [GetAkeebaBackup] ###################
        "'
    - jobref:
        group: net/fleetingclouds/install/joomla/akeeba
        name: GetAkeebaBackup
        args: -sudoPwdRunDeck ${option.sudoPwdRunDeck} -InstallersRepository ${option.InstallersRepository}
    - exec: 'echo " ####################  Calling [GetAkeebaKickstart] ###################
        "'
    - jobref:
        group: net/fleetingclouds/install/joomla/akeeba
        name: GetAkeebaKickStart
        args: -sudoPwdRunDeck ${option.sudoPwdRunDeck} -InstallersRepository ${option.InstallersRepository}
    - exec: 'echo " ####################  Calling [GetVirtueMart] ###################
        "'
    - exec: '# GetVirtueMart'
    - exec: '# net/fleetingclouds/install/joomla/virtuemart'
    - exec: '# -sudoPwdRunDeck ${option.sudoPwdRunDeck} -InstallersRepository ${option.InstallersRepository}'
    - exec: 'echo " ####################  Calling [GetBackupToRestore] ###################
        "'
    - jobref:
        group: net/fleetingclouds/install/joomla/akeeba
        name: GetBackupToRestore
        args: -RemoteSiteFtpPassword ${option.RemoteSiteFtpPassword} -BackupVersion ${option.BackupVersion}
    - exec: echo "Done installing Joomla ................................................."
  description: |
    Install Joomla and all the products it depends on.
  name: InstallJoomla
  uuid: net.fleetingclouds.install.joomla
  nodefilters:
    dispatch:
      threadcount: 1
      keepgoing: false
      excludePrecedence: true
      rankOrder: ascending
    include:
      name: curr.*
  group: net/fleetingclouds/install
  options:
    BackupVersion:
      required: true
      description: The version of the backup file we want to restore
      value: 20120806-124151
    BuildDirectory:
      required: true
      description: Where programs are built.
      value: ~/build
    Host:
      required: true
      description: The host where the test script file should go
      value: meta.fleetingclouds.net
      values:
      - meta.fleetingclouds.net
      - mol.fleetingclouds.net
    InstallersRepository:
      required: true
      value: ~/installers
    JoomlaDataBase:
      required: true
      description: The name of the MySQL database for Joomla to use
      value: joomladb
    MySqlJoomlaPwd:
      required: true
      description: Joomla user password.
      value: okmmpl,,
      secure: true
      valueExposed: true
    MySqlJoomlaUser:
      required: true
      description: A MySQL username
      value: joomlaadmin
    MySqlRootPwd:
      required: true
      description: The root access password for all of MySql
      value: okmmpl,,
      secure: true
      valueExposed: true
    MySqlServer:
      required: true
      description: The name of the MySQL host
      value: localhost
    PurgeApache:
      enforced: true
      required: true
      description: yes or no to purge Apache
      value: 'true'
      values:
      - 'false'
      - 'true'
    RemoteSiteFtpPassword:
      required: true
      description: Since the file is obtained by ftp a user name and password are required.
      value: Water454
    sudoPwdRunDeck:
      required: true
      value: okmmpl,,
      secure: true
